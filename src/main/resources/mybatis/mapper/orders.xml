<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.postella.dao.OrdersDao">

	<select id="selectUsName" parameterType="int" resultType="String">
		select users.us_name
		from orders, users
		where orders.us_no = users.us_no
		and od_no = #{od_no}
	</select>
	
	<select id="selectOdDate" parameterType="int" resultType="Date">
		SELECT od_date
		FROM orders
		WHERE us_no = #{us_no}
		GROUP BY od_date
		ORDER BY od_date DESC
	</select>
	
	<select id="selectOrderList" parameterType="java.util.Map" resultType="Orders">
		SELECT
		    od_date,
		    get_code_value('OR', od_status) as od_status,
		    prd_name,
		    od_detail_qty,
		    od_detail_price,
		    prd_no,
		    ord.od_no as od_no,
		    od_detail_no
		FROM
		         orders ord
		    JOIN (
		        SELECT
		            pr.prd_name,
		            od.od_no,
		            od.prd_no,
		            od.od_detail_qty,
		            od.od_detail_price,
		            od.od_detail_no
		        FROM
		                 order_detail od
		            JOIN product pr ON od.prd_no = pr.prd_no
		    ) prd ON ord.od_no = prd.od_no
		WHERE
		        us_no = ${us_no}
		ORDER BY
    			od_date DESC
	</select>
	
	<delete id="deleteOrder" parameterType="int">
		delete from orders
		where od_no = ${od_no}
	</delete>
	
</mapper>