<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.postella.dao.CartDao">

	<insert id="insertPrdToCart" parameterType="Cart">
		insert into cart(us_no, prd_no, crt_qty) VALUES (#{us_no},#{prd_no},#{crt_qty})
	</insert>
	
	<select id="selectCart" parameterType="java.util.Map" resultType="Cart">
		select *
		from cart
		where us_no = #{us_no} and prd_no = #{prd_no}
	</select>
	
	<update id="updateCart" parameterType="Cart">
		update cart set crt_qty = #{crt_qty}
		where us_no = #{us_no} and prd_no = #{prd_no}
	</update>
	
	<select id="selectCartByUsNo" parameterType="int" resultType="Cart">
		select p.prd_name, p.prd_price, p.prd_ship_fee, c.us_no, c.prd_no, c.crt_qty
		from product p, cart c
		where p.prd_no = c.prd_no and us_no=#{us_no}
	</select>
	
	<select id="selectCartImg" resultType="Img">
		SELECT img_file, img_type, prd_no
		FROM (
		    SELECT i.img_file, i.img_type, c.prd_no, i.img_use,
		           ROW_NUMBER() OVER (PARTITION BY c.prd_no ORDER BY c.prd_no) AS rn
		    FROM image i
		    INNER JOIN cart c ON i.prd_no = c.prd_no
            where img_use = 'THM'
		)
		WHERE rn = 1
	</select>
	
	<delete id="deleteCart" parameterType="java.util.Map">
		DELETE from cart
 		where prd_no=#{prd_no}
 		and us_no=#{us_no}
	</delete>
	
</mapper>