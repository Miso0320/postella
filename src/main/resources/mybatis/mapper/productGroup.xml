<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.postella.dao.ProductGroupDao">

	<!-- 상품목록 -->
	<select id="selectByPage" parameterType="java.util.Map" resultType="Product">
		SELECT pg_no, pg_name, prd_no, prd_org_price, prd_price, prd_category, prd_date
			FROM
			    (
			        SELECT ROWNUM AS rnum, pg_no, pg_name, prd_no, prd_org_price, prd_price, prd_category, prd_date
			        FROM
			            (
			                SELECT pg.pg_no, pg.pg_name, p.prd_no, p.prd_org_price, p.prd_price, p.prd_category, p.prd_date,
			                    ROW_NUMBER() OVER(PARTITION BY pg.pg_no ORDER BY pg.pg_no ) AS row_num
			                FROM product p
			                    LEFT JOIN product_group pg ON p.pg_no = pg.pg_no
			            ) a
			        WHERE
			                a.row_num = 1
			            <if test='prd_category != null and prd_category != ""'>
			            	AND prd_category = #{prd_category, jdbcType=VARCHAR}
			            </if>
		<![CDATA[
			            AND ROWNUM <= ${pager.endRowNo}
			        ORDER BY
			            a.pg_no
			    )
			WHERE
			    rnum >= ${pager.startRowNo}
      	]]>
	</select>
	
	<!-- 상품전체 개수 -->
	<select id="count" resultType="int">
		select count(*) 
		from product
	</select>
	
	<!-- 대표이미지가져오기 -->
	<select id="selectByPgNo" parameterType="int" resultType="Img">
		select *
		from image
		where pg_no=#{pg_no} and ROWNUM = 1
	</select>
	
	<!-- 카테고리 목록 -->
	<select id="selectCategoryList" resultType="CodeTb">
		select code, codeval from code where groupcode = 'PR'
	</select>
	
	<!-- 브랜드 목록(필터) -->
	<select id="selectBrandList" resultType="CodeTb">
		select code, codeval from code where groupcode = 'FB'
	</select>
	
	<!-- 상품상태 목록(필터) -->
	<select id="selectStatusList" resultType="CodeTb">
		select code, codeval from code where groupcode = 'FS'
	</select>
	
	<!-- 상품메시지 목록(필터) -->
	<select id="selectMessageList" resultType="CodeTb">
		select code, codeval from code where groupcode = 'FM'
	</select>
	
	<!-- product 전체 -->
	<select id="selectAllByPgNo" parameterType="int" resultType="Product">
		SELECT *
		from product
		where pg_no = ${pg_no} and ROWNUM = 1
	</select>
</mapper>