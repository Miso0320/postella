<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.postella.dao.ProductGroupDao">

	<select id="selectByPage" parameterType="Pager"
		resultType="ProductGroup">
		
		<![CDATA[
         select pg_no, pg_name
         from (
            select rownum as rnum, pg_no, pg_name 
            from (
               select pg_no, pg_name
               from product_group
                   where pg_no in (
                      select distinct pg_no
                      from product
     	]]>
                      <where>
                      	<if test='prd_category != null and prd_category !=""'>
                      		prd_category=#{prd_category}
                      	</if>
                      </where>
   		<![CDATA[   )
               order by pg_no
            )
            where rownum <= ${endRowNo}
         )
         where rnum >= ${startRowNo}
      ]]>
	</select>

	<select id="count" parameterType="String" resultType="int">
		SELECT count(*)
                FROM
                    product_group
                WHERE
                    pg_no IN (
                        SELECT DISTINCT
                            pg_no
                        FROM
                            product
                        <where>
                      	<if test='prd_category != null and prd_category !=""'>
                      		prd_category=#{categoryList}
                      	</if>
                      </where>
                            )
	</select>
	
	<select id="selectByPgNo" parameterType="int" resultType="Img">
		select *
		from image
		where pg_no=#{pg_no}
	</select>


	<select id="selectTitleByPgNo" parameterType="int" resultType="String">
		SELECT pg_name
		from product_group
		where pg_no = ${pg_no}
	</select>
	
	<select id="selectPriceByPgNo" parameterType="int" resultType="Product">
		select a.prd_price
		from product a join product_group b
		on a.pg_no = ${pg_no}
	</select>

</mapper>